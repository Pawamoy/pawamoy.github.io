


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Findings, thoughts, tutorials, work. Pieces of my mind!">
      
      
        <link rel="canonical" href="https://pawamoy.github.io/posts/django-auth-server-for-shiny/">
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>Django application as an authentication / authorization server for Shiny - pawamoy's website</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4dd2dd8d.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.6a5ad368.min.css">
      
      
        
        
        <meta name="theme-color" content="#ffc105">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://pawamoy.github.io/" title="pawamoy's website" class="md-header-nav__button md-logo" aria-label="pawamoy's website">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            pawamoy's website
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Django application as an authentication / authorization server for Shiny
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/pawamoy/website/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pawamoy/website
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../migrate-disqus-comments-to-utterances-github/" class="md-tabs__link md-tabs__link--active">
          Posts
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../showcase/" class="md-tabs__link">
          Showcase
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://pawamoy.github.io/" title="pawamoy's website" class="md-nav__button md-logo" aria-label="pawamoy's website">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    pawamoy's website
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/pawamoy/website/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pawamoy/website
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../credits/" title="Credits" class="md-nav__link">
      Credits
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Posts
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Posts" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Posts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../migrate-disqus-comments-to-utterances-github/" title="Migrate Disqus comments to Utterances (in GitHub issues) with Python" class="md-nav__link">
      Migrate Disqus comments to Utterances (in GitHub issues) with Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../how-to-deal-with-jinja2-spacing/" title="How to deal with spacing in Jinja2 templates" class="md-nav__link">
      How to deal with spacing in Jinja2 templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unify-logging-for-a-gunicorn-uvicorn-app/" title="Unify Python logging for a Gunicorn/Uvicorn/FastAPI application" class="md-nav__link">
      Unify Python logging for a Gunicorn/Uvicorn/FastAPI application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../save-pytest-logs-as-artifact-gitlab-ci/" title="Save the logs generated during a pytest run as a job artifact on GitLab CI" class="md-nav__link">
      Save the logs generated during a pytest run as a job artifact on GitLab CI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../challenge-fill-space-one-line-90-degree-same-direction/" title="Challenge: fill a 2D space with one continuous line doing 90° angle turns in the same direction (left/right)" class="md-nav__link">
      Challenge: fill a 2D space with one continuous line doing 90° angle turns in the same direction (left/right)
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Django application as an authentication / authorization server for Shiny
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Django application as an authentication / authorization server for Shiny" class="md-nav__link md-nav__link--active">
      Django application as an authentication / authorization server for Shiny
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrapping-a-shiny-app-into-a-django-powered-page" class="md-nav__link">
    Wrapping a Shiny app into a Django-powered page
  </a>
  
    <nav class="md-nav" aria-label="Wrapping a Shiny app into a Django-powered page">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-shiny-app" class="md-nav__link">
    The Shiny app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-django-app" class="md-nav__link">
    The Django app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injecting-the-html-contents-in-an-iframe" class="md-nav__link">
    Injecting the HTML contents in an Iframe
  </a>
  
    <nav class="md-nav" aria-label="Injecting the HTML contents in an Iframe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-wrapping-view" class="md-nav__link">
    Create the wrapping view
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-wrapping-html-page" class="md-nav__link">
    Create the wrapping HTML page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-json-view" class="md-nav__link">
    Create the JSON view
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxying-shiny-requests-to-the-shiny-app" class="md-nav__link">
    Proxying Shiny requests to the Shiny app
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-an-authentication-step-for-every-shiny-request" class="md-nav__link">
    Adding an authentication step for every Shiny request
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-it-with-a-dockerized-project" class="md-nav__link">
    Try it with a Dockerized project
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dual-screens-setup-nvidia-bunsenlabs-debian-jessie/" title="How to install NVidia drivers on BunsenLabs/Debian 8 to setup dual screens" class="md-nav__link">
      How to install NVidia drivers on BunsenLabs/Debian 8 to setup dual screens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker-compose-django-postgres-nginx/" title="Docker Compose with NginX, Django, Gunicorn and multiple Postgres databases" class="md-nav__link">
      Docker Compose with NginX, Django, Gunicorn and multiple Postgres databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python-static-code-analysis-tools/" title="Python static code analysis tools" class="md-nav__link">
      Python static code analysis tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../write-and-use-a-tox-plugin-from-inside-your-package/" title="Write and use a tox plugin from inside your package" class="md-nav__link">
      Write and use a tox plugin from inside your package
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../documentation-in-your-shell-scripts-using-shellman/" title="Documentation in your shell scripts using shellman" class="md-nav__link">
      Documentation in your shell scripts using shellman
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../django-dashboard-with-suit-and-highcharts/" title="Django admin dashboard with Suit and Highcharts" class="md-nav__link">
      Django admin dashboard with Suit and Highcharts
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Showcase
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Showcase" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Showcase
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/" title="Showcase Grid" class="md-nav__link">
      Showcase Grid
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Projects
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Projects" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        <span class="md-nav__icon md-icon"></span>
        Projects
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/aria2p/" title="aria2p" class="md-nav__link">
      aria2p
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/mkdocstrings/" title="mkdocstrings" class="md-nav__link">
      mkdocstrings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/copier-poetry/" title="copier-poetry" class="md-nav__link">
      copier-poetry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/pytkdocs/" title="pytkdocs" class="md-nav__link">
      pytkdocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/git-changelog/" title="git-changelog" class="md-nav__link">
      git-changelog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/shell-history/" title="shell-history" class="md-nav__link">
      shell-history
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/failprint/" title="failprint" class="md-nav__link">
      failprint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/dependenpy/" title="dependenpy" class="md-nav__link">
      dependenpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/mvodb/" title="mvodb" class="md-nav__link">
      mvodb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/shelldemo/" title="shelldemo" class="md-nav__link">
      shelldemo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../showcase/shellman/" title="shellman" class="md-nav__link">
      shellman
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrapping-a-shiny-app-into-a-django-powered-page" class="md-nav__link">
    Wrapping a Shiny app into a Django-powered page
  </a>
  
    <nav class="md-nav" aria-label="Wrapping a Shiny app into a Django-powered page">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-shiny-app" class="md-nav__link">
    The Shiny app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-django-app" class="md-nav__link">
    The Django app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injecting-the-html-contents-in-an-iframe" class="md-nav__link">
    Injecting the HTML contents in an Iframe
  </a>
  
    <nav class="md-nav" aria-label="Injecting the HTML contents in an Iframe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-wrapping-view" class="md-nav__link">
    Create the wrapping view
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-wrapping-html-page" class="md-nav__link">
    Create the wrapping HTML page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-json-view" class="md-nav__link">
    Create the JSON view
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxying-shiny-requests-to-the-shiny-app" class="md-nav__link">
    Proxying Shiny requests to the Shiny app
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-an-authentication-step-for-every-shiny-request" class="md-nav__link">
    Adding an authentication step for every Shiny request
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-it-with-a-dockerized-project" class="md-nav__link">
    Try it with a Dockerized project
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  <h1>Django application as an authentication / authorization server for Shiny</h1>
  <p class="post-meta">
    Published Mar 15, 2018
    by Timothée Mazzucotelli
  </p>
  <p>As you may know, <a href="https://www.rstudio.com/products/shiny/shiny-server/">Shiny Server</a> comes in two versions: open-source and
professional. The professional adds security and authentication features
like <em>password protected applications</em>, and <em>controlled access via SSL and LDAP,
Active Directory, Google OAuth, PAM, proxied authentication, or passwords</em>.
If you need these authentication features but don't want or can't spend
<a href="https://www.rstudio.com/pricing/#ShinyProPricing">$9,995 per year</a> for the professional edition, then I got a solution for you!</p>
<!--more-->

<p>In this post, I will show how to wrap one or several Shiny applications into
a Django application to add authentication and access control to your Shiny
apps. The shining star here will not be Django, as you could replace it by
any other web application you want, but the famous NginX reverse proxy,
accompanied by its devoted <a href="https://nginx.org/en/docs/http/ngx_http_auth_request_module.html">auth-request</a> module.</p>
<p>The code used in this post is also available as a <a href="https://github.com/Pawamoy/docker-nginx-auth-request-django-shiny-example">repository on GitHub</a>.
It contains a Docker configuration so you can try it easily.</p>
<p><strong>On the menu</strong></p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#wrapping-a-shiny-app-into-a-django-powered-page">Wrapping a Shiny app into a Django-powered page</a></li>
<li><a href="#proxying-shiny-requests-to-the-shiny-app">Proxying Shiny requests to the Shiny app</a></li>
<li><a href="#adding-an-authentication-step-for-every-shiny-request">Adding an authentication step for every Shiny request</a></li>
<li><a href="#try-it-with-a-dockerized-project">Try it with a Dockerized project</a></li>
<li><a href="#__comments">Comments</a></li>
</ul>
<p>What most of you will be interested in is starting at section 2:
<a href="#proxying-shiny-requests-to-the-shiny-app">Proxying</a>, though <a href="#wrapping-a-shiny-app-into-a-django-powered-page">Wrapping</a> is interesting as well if you
want to create an interface to access multiple Shiny apps.</p>
<hr />
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¤</a></h2>
<p>Let's look at some pictures to see what we want to accomplish. The first picture
shows our client-server architecture. The client can communicate with the server
on the port 80 or 443 (HTTP or HTTPs), but not on the ports 8000 or 8100, which
are used internally by Django and Shiny. This can be configured through the
firewall.</p>
<p><img alt="client-server-architecture" src="/assets/client-server-architecture.png" /></p>
<p>The second picture shows what happens when the client requests the URL
that the Shiny app is served on. As we wrap the Shiny app into a Django-powered
page, the request is proxied directly to Django by NginX. Django then gets the
initial Shiny page HTML contents with an internal HTTP Get request, and renders
it in a <code>iframe</code> (we will see the details later). It then returns this rendered
page to NginX, which returns it to the client.</p>
<p><img alt="client-requests-shiny" src="/assets/client-requests-shiny.png" /></p>
<p>The third picture shows each subsequent requests from the client to the server
through a WebSocket, and how NginX is asking authorization to Django. When NginX
receives the request, it sends a sub-request to Django, asking for permission
to proxy the request to Shiny and return the response to the client. If Django
says yes (HTTP 200), NginX proxies the request to Shiny. If Django says no
(HTTP 403 or any other error code), NginX rejects the request by returning
HTTP 403 as a response to the client.</p>
<p><img alt="client-shiny-subrequests" src="/assets/client-shiny-subrequests.png" /></p>
<p>OK, let's try it! To begin, create a directory that we will use for this
tutorial:</p>
<div class="highlight"><pre><span></span><code>mkdir django-shiny
<span class="nb">cd</span> django-shiny
</code></pre></div>

<hr />
<h2 id="wrapping-a-shiny-app-into-a-django-powered-page">Wrapping a Shiny app into a Django-powered page<a class="headerlink" href="#wrapping-a-shiny-app-into-a-django-powered-page" title="Permanent link">¤</a></h2>
<p>This first section will help you setup an example project to follow this
tutorial, but the first two steps described are optional. You can immediately
jump to the <a href="#proxying-shiny-requests-to-the-shiny-app">Proxying Shiny requests</a>
section where we will a use pre-setup example project using Docker. You will
need to install Docker if you don't already have it. See <a href="https://docs.docker.com/install/">Install Docker</a> for
installation instructions.</p>
<p>The third step however might be interesting to read if you need to wrap your
Shiny app into a Django-powered page and website, instead of just using Django
as an external authentication / authorization backend.</p>
<ol>
<li><a href="#the-shiny-app">The Shiny app</a></li>
<li><a href="#the-django-app">The Django app</a></li>
<li><a href="#injecting-the-html-contents-in-an-iframe">Injecting the HTML contents in an Iframe</a></li>
</ol>
<hr />
<h3 id="the-shiny-app">The Shiny app<a class="headerlink" href="#the-shiny-app" title="Permanent link">¤</a></h3>
<p>Let's get a Shiny app example from <a href="https://shiny.rstudio.com/gallery/">RStudio's gallery</a>.
The code is available on GitHub in <a href="https://github.com/rstudio/shiny-examples/tree/master/001-hello">this repository</a>.</p>
<p>Clone it in a sub-directory called <code>shinyapp</code>:</p>
<div class="highlight"><pre><span></span><code>git clone --depth<span class="o">=</span><span class="m">1</span> https://github.com/rstudio/shiny-examples
mv shiny-examples/001-hello shinyapp
rm -rf shiny-examples
</code></pre></div>

<p>We also need to install the Shiny R package. If you don't already have R
installed, you can install a recent version with the following commands:</p>
<div class="highlight"><pre><span></span><code>sudo add-apt-repository &quot;deb http://cran.rstudio.com/bin/linux/ubuntu trusty/&quot;
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E084DAB9
sudo add-apt-repository ppa:marutter/rdev
sudo apt-get update
sudo apt-get install -y r-base
</code></pre></div>

<p>Run this command to install Shiny:</p>
<div class="highlight"><pre><span></span><code>sudo R -e <span class="s2">&quot;install.packages(&#39;shiny&#39;, repos=&#39;https://cran.rstudio.com/&#39;)&quot;</span>
</code></pre></div>

<p>To run the Shiny application on port 8100, use the following command:</p>
<div class="highlight"><pre><span></span><code>sudo R -e <span class="s2">&quot;shiny::runApp(appDir=&#39;shinyapp&#39;, port=8100)&quot;</span>
</code></pre></div>

<p>Try to go to <code>http://localhost:8100</code>      to see if the app is running.</p>
<hr />
<h3 id="the-django-app">The Django app<a class="headerlink" href="#the-django-app" title="Permanent link">¤</a></h3>
<p>We will create a new Django project called <code>djangoapp</code>. If you don't already
have Django installed on your system, install it in a virtualenv with
<code>pip install Django</code>, or system-wide with <code>sudo pip install Django</code>.</p>
<p>To create the project, run the following command:</p>
<div class="highlight"><pre><span></span><code>django-admin startproject djangoapp
</code></pre></div>

<p>We need to initialize the SQLite database first.</p>
<div class="highlight"><pre><span></span><code>python djangoapp/manage.py migrate
</code></pre></div>

<p>You can now run the Django application on port 8000 with the following command:</p>
<div class="highlight"><pre><span></span><code>python djangoapp/manage.py runserver localhost:8000
</code></pre></div>

<p>And try to go to <code>http://localhost:8000</code> to see if the app is running.</p>
<hr />
<h3 id="injecting-the-html-contents-in-an-iframe">Injecting the HTML contents in an Iframe<a class="headerlink" href="#injecting-the-html-contents-in-an-iframe" title="Permanent link">¤</a></h3>
<p>At this point you should have the following tree:</p>
<div class="highlight"><pre><span></span><code>.
├── djangoapp
│   ├── db.sqlite3
│   ├── djangoapp
│   │   ├── __init__.py
│   │   ├── settings.py
│   │   ├── urls.py
│   │   └── wsgi.py
│   └── manage.py
└── shinyapp
    ├── app.R
    ├── DESCRIPTION
    └── Readme.md

3 directories, 9 files
</code></pre></div>

<p>We will proceed in three main steps:</p>
<ol>
<li><a href="#create-the-wrapping-view">Create a simple view that renders our wrapping HTML page</a></li>
<li><a href="#create-the-wrapping-html-page">Create this wrapping HTML page</a> that will:<ol>
<li>Create an Iframe and add it to the DOM</li>
<li>Get the Shiny HTML contents in JSON format, with an asynchronous call</li>
<li>Inject these contents in the Iframe</li>
</ol>
</li>
<li><a href="#create-the-json-view">Create the view to return Shiny HTML contents as JSON</a> by:<ol>
<li>Getting the contents with a GET request</li>
<li>Parsing it with <a href="https://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a>'s HTML parser</li>
<li>Dumping and returning it as JSON</li>
</ol>
</li>
</ol>
<hr />
<h4 id="create-the-wrapping-view">Create the wrapping view<a class="headerlink" href="#create-the-wrapping-view" title="Permanent link">¤</a></h4>
<p>Let's create our wrapping view. First make sure you have listed <code>djangoapp</code>
in the Django settings' <code>INSTALLED_APPS</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># settings.py</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>

    <span class="s1">&#39;djangoapp&#39;</span>
<span class="p">]</span>
</code></pre></div>

<p>Then we can add the URL in <code>urls.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;shiny/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">shiny</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;shiny&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>And now we create the view in a new <code>views.py</code> file:</p>
<div class="highlight"><pre><span></span><code>touch djangoapp/djangoapp/views.py
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>

<span class="k">def</span> <span class="nf">shiny</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangoapp/shiny.html&#39;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h4 id="create-the-wrapping-html-page">Create the wrapping HTML page<a class="headerlink" href="#create-the-wrapping-html-page" title="Permanent link">¤</a></h4>
<p>Since we tell the view to render the <code>djangoapp/shiny.html</code> template, we need
to create it:</p>
<div class="highlight"><pre><span></span><code>mkdir -p djangoapp/djangoapp/templates/djangoapp
touch djangoapp/djangoapp/templates/djangoapp/shiny.html
<span class="c1"># too much of djangoapp already, I know</span>
</code></pre></div>

<p>And write its contents. We simply add a title, to know we are in the wrapping
view, and then we add a script to retrieve the Shiny app contents:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>We are in the wrapping page!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;contents&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;{% url &quot;shiny_contents&quot; %}&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;iframe&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#contents&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>

      <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
      <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">html_contents</span><span class="p">);</span>
      <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>

      <span class="c1">// Attempt circumvention</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">)</span>
          <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">WebSocket</span><span class="p">;</span>
    <span class="p">});</span>

  <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>

<p>Several things happen here:</p>
<ul>
<li>we declare a <code>div</code> of ID <code>contents</code> in which we will add an <code>iframe</code>,</li>
<li>we make use of JQuery's <code>$(document).ready</code> and <code>$.getJSON</code> methods to
  load HTML contents from an URL returning JSON,</li>
<li>we create the <code>iframe</code>, add it in the document, then write the HTML contents
  inside of it. We also reassign the <code>WebSocket</code> variable to the value of the
  <code>iframe</code> one.</li>
</ul>
<hr />
<h4 id="create-the-json-view">Create the JSON view<a class="headerlink" href="#create-the-json-view" title="Permanent link">¤</a></h4>
<p>As you maybe guessed, work is not finished. We need to add the <code>shiny_contents</code>
URL and view in the Django app. The view must return the contents of the Shiny
app initial page as JSON.</p>
<p>Add the URL in <code>urls.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;shiny/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">shiny</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;shiny&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;shiny_contents/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">shiny_contents</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;shiny_contents&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>Add the view to <code>views.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>


<span class="k">def</span> <span class="nf">shiny</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;djangoapp/shiny.html&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">shiny_contents</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:8100&#39;</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;html_contents&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">soup</span><span class="p">)})</span>
</code></pre></div>

<p>We are using requests and BeautifulSoup to get the HTML contents and return
it as text, dumped as JSON. If you know a better way, let me know in the
comments!</p>
<p>To install requests and BeautifulSoup: <code>pip install requests beautifulsoup4</code>.</p>
<p>OK, let's try! Run both the Shiny application and the Django application, then
go to <a href="http://localhost:8000/shiny">http://localhost:8000/shiny</a> to see how it goes!</p>
<p>You should see something like the following image:</p>
<p><img alt="screenshot-django-shiny" src="/assets/screenshot-django-shiny.png" /></p>
<p>But since Shiny requests are not proxied, they are simply lost in-between, and
your Shiny app will not respond, nor get a nice look because the static assets
will not be loaded. We will fix this in the next section:
<a href="#proxying-shiny-requests-to-the-shiny-app">Proxying Shiny requests</a>.</p>
<p>This is it for the setup and the Django-wrapped Shiny page. For the rest of the
tutorial, I will explain how to configure NginX and Django to act as proxy
and authorization servers. The result is available for you to try in this
repository: <a href="https://github.com/Pawamoy/docker-nginx-auth-request-django-shiny-example">https://github.com/Pawamoy/docker-nginx-auth-request-django-shiny-example</a>.
See the <a href="#try-it-with-a-dockerized-project">Try it out</a> section.</p>
<hr />
<h2 id="proxying-shiny-requests-to-the-shiny-app">Proxying Shiny requests to the Shiny app<a class="headerlink" href="#proxying-shiny-requests-to-the-shiny-app" title="Permanent link">¤</a></h2>
<p>This is time for NginX to come on stage. We need to create our new,
project-specific configuration file in <code>/etc/nginx/sites-available/djangoshiny</code>.</p>
<p>We will tell NginX to proxy every request with an URL like <code>shiny/*</code> to our
Shiny app. All other requests will be proxied to the Django app.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># declare your Django app</span>
<span class="k">upstream</span> <span class="s">djangoapp_server</span> <span class="p">{</span>
    <span class="kn">server</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># declare your Shiny app</span>
<span class="k">upstream</span> <span class="s">shinyapp_server</span> <span class="p">{</span>
    <span class="kn">server</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8100</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># required for WebSockets</span>
<span class="k">map</span> <span class="nv">$http_upgrade</span> <span class="nv">$connection_upgrade</span> <span class="p">{</span>
    <span class="kn">default</span> <span class="s">upgrade</span><span class="p">;</span>
    <span class="kn">&#39;&#39;</span> <span class="s">close</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>

    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>

    <span class="kn">client_max_body_size</span> <span class="s">100M</span><span class="p">;</span>

    <span class="c1"># normal requests go to Django</span>
    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://djangoapp_server</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">if</span> <span class="s">(!-f</span> <span class="nv">$request_filename</span><span class="s">)</span> <span class="p">{</span>
            <span class="kn">proxy_pass</span> <span class="s">http://djangoapp_server</span><span class="p">;</span>
            <span class="kn">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># &quot;shiny&quot; requests go to Shiny</span>
    <span class="kn">location</span> <span class="p">~</span> <span class="sr">/shiny/.+</span> <span class="p">{</span>

        <span class="kn">rewrite</span> <span class="s">^/shiny/(.*)</span>$ <span class="s">/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

        <span class="kn">proxy_pass</span> <span class="s">http://shinyapp_server</span><span class="p">;</span>
        <span class="kn">proxy_redirect</span> <span class="s">http://shinyapp_server/</span> <span class="nv">$scheme://$host/shiny/</span><span class="p">;</span>

        <span class="c1"># required for WebSockets</span>
        <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Upgrade</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="nv">$connection_upgrade</span><span class="p">;</span>

        <span class="kn">proxy_read_timeout</span> <span class="s">20d</span><span class="p">;</span>
        <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<p>Once you're ready, enable this configuration by linking it like this:</p>
<div class="highlight"><pre><span></span><code>sudo ln -s /etc/nginx/sites-available/djangoshiny /etc/nginx/sites-enabled/djangoshiny
</code></pre></div>

<p>Now reload NginX, and that's it! If you launch both Django on port 8000, and
Shiny on port 8100, you should be able to connect to <code>http://localhost/shiny</code>
and enjoy your Django-wrapped Shiny application functioning properly!</p>
<p>There is still one thing we need to add: authentication and authorization.
I won't show how to create sign-in / sign-up / sign-out views: you can
find all the documentation to enable Django authentication system online.
What I will show you is how to make Django act as an authorization server
for Shiny.</p>
<hr />
<h2 id="adding-an-authentication-step-for-every-shiny-request">Adding an authentication step for every Shiny request<a class="headerlink" href="#adding-an-authentication-step-for-every-shiny-request" title="Permanent link">¤</a></h2>
<p>We want all requests proxied to Shiny to be authorized by Django. For this we
are gonna use the <a href="https://nginx.org/en/docs/http/ngx_http_auth_request_module.html">auth-request</a> module. This module is not compiled in
NginX by default on distributions like Ubuntu / Debian. If you want to recompile
NginX with auth-request enabled, check how I do it in <a href="https://github.com/Pawamoy/docker-nginx-auth-request-django-shiny-example/blob/master/Dockerfile.nginx">this Dockerfile</a>.</p>
<p>An easier solution is to use the Docker setup from the same repository, with
the official NginX image which already supports auth-request.</p>
<p>So, once your NginX is ready, add this authorization step in the configuration
file:</p>
<div class="highlight"><pre><span></span><code>    <span class="k">location</span> <span class="p">~</span> <span class="sr">/shiny/.+</span> <span class="p">{</span>

        <span class="c1"># we tell nginx to call that location for each request</span>
        <span class="kn">auth_request</span> <span class="s">/auth</span><span class="p">;</span>

        <span class="kn">rewrite</span> <span class="s">^/shiny/(.*)</span>$ <span class="s">/</span><span class="nv">$1</span> <span class="s">break</span><span class="p">;</span>

        <span class="kn">proxy_pass</span> <span class="s">http://shinyapp_server</span><span class="p">;</span>
        <span class="kn">proxy_redirect</span> <span class="s">http://shinyapp_server/</span> <span class="nv">$scheme://$host/shiny/</span><span class="p">;</span>

        <span class="c1"># this part is needed for WebSockets to work</span>
        <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Upgrade</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="nv">$connection_upgrade</span><span class="p">;</span>

        <span class="kn">proxy_read_timeout</span> <span class="s">20d</span><span class="p">;</span>
        <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># the /auth location will send a subrequest to django, URL shiny_auth/</span>
    <span class="k">location</span> <span class="p">=</span> <span class="s">/auth</span> <span class="p">{</span>
        <span class="kn">internal</span><span class="p">;</span>

        <span class="kn">proxy_pass</span> <span class="s">http://localhost:8000/shiny_auth/</span><span class="p">;</span>

        <span class="kn">proxy_pass_request_body</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Content-Length</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Original-URI</span> <span class="nv">$request_uri</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>

<p>Of course, we also need to write the view called by the <code>shiny_auth/</code> URL.
It's a very simple one. First add the URL in <code>urls.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;shiny/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">shiny</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;shiny&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;shiny_contents/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">shiny_contents</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;shiny_contents&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;shiny_auth/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">shiny_auth</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>And then the view in <code>views.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">shiny_auth</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">403</span><span class="p">)</span>
</code></pre></div>

<p>Et voilà! If the user is authenticated, Django will say "OK". If the user is
not authenticated, Django will say "No". But you could implement any logic
you need instead of just checking if the user is authenticated or not. You
could have several Shiny apps served on different URLs, powered by Django
(in wrapping pages, as we saw earlier), and grant access to users with a
permission system, etc..</p>
<h2 id="try-it-with-a-dockerized-project">Try it with a Dockerized project<a class="headerlink" href="#try-it-with-a-dockerized-project" title="Permanent link">¤</a></h2>
<p>Clone the repository and build the images with the following commands:</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/Pawamoy/docker-nginx-auth-request-django-shiny-example docker-django-shiny
cd docker-django-shiny
sudo make all
</code></pre></div>

<p>This first build should take quite some time. It will build Shiny and Django
images, get static assets, create the database, create a super user, and then
run the application. You will then be able to go to <code>http://localhost:8000</code>
to see it in action.</p>
<p>To print the available <code>make</code> commands, simply run <code>make</code>.</p>

              
  <hr>
  <script src="https://utteranc.es/client.js"
          repo="pawamoy/pawamoy.github.io"
          issue-term="pathname"
          theme="preferred-color-scheme"
          crossorigin="anonymous"
          async>
  </script>

            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../challenge-fill-space-one-line-90-degree-same-direction/" title="Challenge: fill a 2D space with one continuous line doing 90° angle turns in the same direction (left/right)" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Challenge: fill a 2D space with one continuous line doing 90° angle turns in the same direction (left/right)
              </div>
            </div>
          </a>
        
        
          <a href="../dual-screens-setup-nvidia-bunsenlabs-debian-jessie/" title="How to install NVidia drivers on BunsenLabs/Debian 8 to setup dual screens" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                How to install NVidia drivers on BunsenLabs/Debian 8 to setup dual screens
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/pawamoy" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/pawamoy" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://linkedin.com/in/timothée-mazzucotelli-0321607b/" target="_blank" rel="noopener" title="linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://instagram.com/paaawamoy" target="_blank" rel="noopener" title="instagram.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>